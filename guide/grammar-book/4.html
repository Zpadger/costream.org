

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>Make Hierarchical Stream Program — COStream</title>
    <meta charset="utf-8">
    <meta name="description" content="COStream - The High Performance Dataflow Language and Compiler">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="alternate" hreflang="x-default" href="https://costream.site/guide/grammar-book/4.html">
    <link rel="alternate" hreflang="zh" href="https://cn.costream.site/guide/grammar-book/4.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Make Hierarchical Stream Program — COStream">
    <meta property="og:description" content="COStream - The High Performance Dataflow Language and Compiler">
    <meta property="og:image" content="https://cn.costream.site/images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Make Hierarchical Stream Program — COStream">
    <meta name="twitter:description" content="COStream - The High Performance Dataflow Language and Compiler">
    <meta name="twitter:image" content="https://cn.costream.site/images/logo.png">

<!--
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-icon-152x152.png">
-->
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/icons/android-icon-192x192.png">
<!--
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
-->
    <meta name="msapplication-TileImage" content="/images/icons/favicon.png">
    <link rel="icon" href="/images/icons/favicon.png" type="image/png">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <!-- <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'> -->
    <!-- <link href='//fonts.googleapis.com/css?family=Dosis:500&text=Vue.js' rel='stylesheet' type='text/css'> -->

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="/js/vue.js"></script>
    <script>window.PAGE_TYPE = "guide"</script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46852172-3', 'cn.costream.site');
      ga('send', 'pageview');
    </script>
  </head>
  <body class="docs">
    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/CO.svg">
    <span>COStream</span>
  </a>
  <ul id="nav">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li>
    <a href="/guide/installation.html" class="nav-link team">Install</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
        <li><a href="/guide/" class="nav-link">Guide</a></li>
        <li><a href="/guide/grammar-book/grammar.html" class="nav-link current">Grammar</a></li>
        <li><a href="/api/" class="nav-link">Source</a></li>
      <li><a href="/examples/" class="nav-link">Examples</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
        <li><a href="https://github.com/DML308/COStream/issues" class="nav-link" target="_blank">Forum</a></li>
    </ul></li>
    <li><h4>Tool</h4></li>
    <li>
      <ul>
        <li><a href="https://try.costream.site" class="nav-link" target="_blank"> Dev Online</a></li>
        <li><a href="https://costream.site" class="nav-link" target="_blank">Highlight Plugin</a></li>
      </ul>
    </li>
    <li><h4>Core Libraries</h4></li>
    <li><ul>
<!--    via 陈铭涛-->
      <li><a href="#" class="nav-link" target="_blank">GPU Computing</a></li>
<!--    via 李平然-->
      <li><a href="#" class="nav-link" target="_blank">Dynamic Scheduling</a></li>
<!--    via null-->
      <li><a href="#" class="nav-link" target="_blank">Gragh Partition</a></li>
    </ul></li>
    
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/DML308/COStream" class="nav-link" target="_blank">Official Repos</a></li>
    <li><h4>Associated Links</h4></li>
    <li><ul>
        <li><a href="http://www.hust.edu.cn" class="nav-link" target="_blank">HUST</a></li>
        <li><a href="http://media.hust.edu.cn" class="nav-link" target="_blank">DML</a></li>
        <li><a href="http://faculty.hust.edu.cn/yujunqing/zh_CN/index.htm" class="nav-link" target="_blank">Mater Enrollment</a></li>
        </ul></li> 
    </ul></li>
  </ul>
</li>

<li>
  <a href="/guide/team.html" class="nav-link team">Team</a>
</li>
<!--
<li>
    <a href="#" class="nav-link team">团队</a>
</li>
-->
<li class="nav-dropdown-container language">
  <a class="nav-link">Language</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://costream.site/guide/grammar-book/4.html" class="nav-link" target="_blank">English</a></li>
    <li><a href="https://cn.costream.site/guide/grammar-book/4.html" class="nav-link" target="_blank">简体中文</a></li>
  </ul>
</li>

<!--<li><a href="https://github.com/vuejs/cn.vuejs.org/" target="_blank" class="nav-link contribute">参与翻译</a></li>-->

  </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li>
    <a href="/guide/installation.html" class="nav-link team">Install</a>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Learn</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><ul>
        <li><a href="/guide/" class="nav-link">Guide</a></li>
        <li><a href="/guide/grammar-book/grammar.html" class="nav-link current">Grammar</a></li>
        <li><a href="/api/" class="nav-link">Source</a></li>
      <li><a href="/examples/" class="nav-link">Examples</a></li>
    </ul></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>Help</h4></li>
    <li><ul>
        <li><a href="https://github.com/DML308/COStream/issues" class="nav-link" target="_blank">Forum</a></li>
    </ul></li>
    <li><h4>Tool</h4></li>
    <li>
      <ul>
        <li><a href="https://try.costream.site" class="nav-link" target="_blank"> Dev Online</a></li>
        <li><a href="https://costream.site" class="nav-link" target="_blank">Highlight Plugin</a></li>
      </ul>
    </li>
    <li><h4>Core Libraries</h4></li>
    <li><ul>
<!--    via 陈铭涛-->
      <li><a href="#" class="nav-link" target="_blank">GPU Computing</a></li>
<!--    via 李平然-->
      <li><a href="#" class="nav-link" target="_blank">Dynamic Scheduling</a></li>
<!--    via null-->
      <li><a href="#" class="nav-link" target="_blank">Gragh Partition</a></li>
    </ul></li>
    
    <li><h4>Resource Lists</h4></li>
    <li><ul>
      <li><a href="https://github.com/DML308/COStream" class="nav-link" target="_blank">Official Repos</a></li>
    <li><h4>Associated Links</h4></li>
    <li><ul>
        <li><a href="http://www.hust.edu.cn" class="nav-link" target="_blank">HUST</a></li>
        <li><a href="http://media.hust.edu.cn" class="nav-link" target="_blank">DML</a></li>
        <li><a href="http://faculty.hust.edu.cn/yujunqing/zh_CN/index.htm" class="nav-link" target="_blank">Mater Enrollment</a></li>
        </ul></li> 
    </ul></li>
  </ul>
</li>

<li>
  <a href="/guide/team.html" class="nav-link team">Team</a>
</li>
<!--
<li>
    <a href="#" class="nav-link team">团队</a>
</li>
-->
<li class="nav-dropdown-container language">
  <a class="nav-link">Language</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://costream.site/guide/grammar-book/4.html" class="nav-link" target="_blank">English</a></li>
    <li><a href="https://cn.costream.site/guide/grammar-book/4.html" class="nav-link" target="_blank">简体中文</a></li>
  </ul>
</li>

<!--<li><a href="https://github.com/vuejs/cn.vuejs.org/" target="_blank" class="nav-link contribute">参与翻译</a></li>-->

    </ul>
    <div class="list">
      
      
        <h2>
          
          Guide
<!--
          
            <select class="version-select">
              <option value="SELF" selected>2.x</option>
              <option value="v1">1.0</option>
              <option value="012">0.12</option>
              <option value="011">0.11</option>
            </select>
          
-->
        </h2>
        <ul class="menu-root">
  
    
    
      
        <li><h3>Essentials</h3></li>
      
      
			
    
    
    <li>
      <a href="/guide/index.html" class="sidebar-link">Introduction</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/installation.html" class="sidebar-link">Installation</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/helloworld.html" class="sidebar-link">Try to run</a>
    </li>
  
    
    
      
      
      <li><h3>Grammar Book</h3></li>
      
			
    
    
    <li>
      <a href="/guide/grammar-book/grammar.html" class="sidebar-link">Grammer Introduction</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/grammar-book/2.html" class="sidebar-link">Keyword & Type</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/grammar-book/3.html" class="sidebar-link">Streaming Data Process</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/grammar-book/4.html" class="sidebar-link current">Make Hierarchical Stream Program</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/grammar-book/5.html" class="sidebar-link">Inside Composite</a>
    </li>
  
    
    
      
      
			
    
    
    <li>
      <a href="/guide/grammar-book/Structure of Program.html" class="sidebar-link">Structure of Program</a>
    </li>
  
    
    
      
      
			
      <li><h3>Else</h3></li>
      
    
    
    <li>
      <a href="/guide/team.html" class="sidebar-link">Team Members</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>


<div class="content guide with-sidebar 4-guide">
  
    
  
  
    <h1>Make Hierarchical Stream Program</h1>
  
  
    <h2 id="composite-instance"><a href="#composite-instance" class="headerlink" title="composite instance"></a>composite instance</h2><p>Operator defines the compute node in the dataflow graph.In order to construct dataflow graph which contains different nodes,COStream defines the Composite structure.Composite is a high-level composite structure that represents a reusable dataflow graph structure consisting of one or several operators.It can either completely represent the dataflow graph structure of a stream program or be called as a sub stream graph structure.</p>
<p><img src="/img/PART1-4.1.png" alt="4.1"></p>
<p>As we can see,the MovingAverage is a COStream stream program that only have one composite.It also can be written as a stream program consisting of serval composites.Figure 4.1 shows a MovingAverage consisting of two composites.The entry of the program is the composite named Main.Then composite Main calls the other composite-MyOp.MyOp simply represents a subgraph that only have one operator.We should give input stream,output stream and parameter to the operator.In this program they are S,P and N.The corresponding composite will be instantiated using the input stream,output stream and parameter whtn it be called.Similar to the C,we need to define a Main composite as the entry of the program when there are serval composites in the program.</p>
<h2 id="composite-definition"><a href="#composite-definition" class="headerlink" title="composite definition"></a>composite definition</h2><p>composite consists of a header and a body part.It’s BNF representation is:<br><code>compositeDef    ::= compositeHead compositeBody</code></p>
<h3 id="composite-header-definition"><a href="#composite-header-definition" class="headerlink" title="composite header definition"></a>composite header definition</h3><p>The grammar of the composite header is similar to the operator.It also consists of a name,input stream and an ouput stream.It’s BNF representation is:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compositeHead	::= &apos;composite&apos; ID &apos;(&apos; (inOutputlist+,)? &apos;)&apos;</span><br><span class="line">inOutputlist	::= (&apos;input&apos;|&apos;output&apos;) ( streamType ID )+,</span><br></pre></td></tr></table></figure></p>
<p>Instance：<code>composite CS(output o1, input i1)</code></p>
<blockquote>
<p>   <strong>Composite Input and Output</strong>  </p>
<ol>
<li>When the program only have one composite or the composite’s name is Main,the input and output stream information can be omitted.</li>
<li>If we need to make a composite that can be called,we must specify the input stream and output stream information. </li>
</ol>
</blockquote>
<h3 id="composite-body-definition"><a href="#composite-body-definition" class="headerlink" title="composite body definition"></a>composite body definition</h3><p>The composite body consists of three parts:a list of param parameters,a list of declarations and definition statements and a list of statements.It’s BNF representation is as follows:<br><figure class="highlight bnf"><table><tr><td class="code"><pre><span class="line">compositeBody ::   = '&#123;'   </span><br><span class="line">			    ('param' paramlist+ ';')?</span><br><span class="line">			    (declaration)*</span><br><span class="line">			    (costreamStmts)+</span><br><span class="line">		     '&#125;'</span><br></pre></td></tr></table></figure></p>
<h2 id="param-parameter-list"><a href="#param-parameter-list" class="headerlink" title="param parameter list"></a>param parameter list</h2><p>The param parameter list starts with the keyword param,followed by a list of parameters similar to C language.The parameters are separated by “,” and it ends when meets the semicolon.<br>Such as: <code>param int a, int b, float c</code>;</p>
<p>Similar to the C function call,the parameter list accepts the call parameters of the compostie and the formal parameters accept the actual value.The transfer mechanism is same as the C language.</p>
<p><strong>param Parameter scope</strong> is for the whole composite,they can be used by all statements in the composite.</p>
<p><strong>param compile time behavior limitation</strong>：the parameter under the current param must be a constant value that can be calculated at compile time.And the argument passed in the call to the composite must be a compile-time constant,otherwise,the compilation error occurs;In addition,<strong>the param parameter can not be modified</strong>.</p>
<h2 id="declaration-and-definition-of-variables-in-composite"><a href="#declaration-and-definition-of-variables-in-composite" class="headerlink" title="declaration and definition of variables in composite"></a>declaration and definition of variables in composite</h2><p>there are c language type variables and stream type variables in COStream.The use of internal variables in composites satisfies the general rules for the use of c language variables.<br>for example：<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a,b,c;</span><br><span class="line">Float e=<span class="number">1.21</span>;</span><br><span class="line">Stream&lt;<span class="keyword">int</span> a,<span class="keyword">int</span> b&gt;G;</span><br></pre></td></tr></table></figure></p>
<p><strong>Declaration and definition statement declaration variable scope</strong> is the entire composite.It allows the built-in operator defined by the composite to be read-only.</p>
<p><strong>Declaration and definition statement list behavior restrictions in compile-time</strong>:the variable declared in the current statement block which is not stream type must be a constant value that can be calculated at compile-time,otherwise the compilation error occurs;In addition,<strong>The built-in operator defined inside the composite can only be read when using the non-stream type</strong>.</p>
<h2 id="composite-statement-blcok"><a href="#composite-statement-blcok" class="headerlink" title="composite statement blcok"></a>composite statement blcok</h2><p>the statement block inside the composite named costreamStmts includes common c statements,operator definitions,composite calls and special operator definitions such as splitjoin and pipeline.The costreamStmts section controls the connection between various operators.It use these connections to construct a dataflow graph.</p>
<h3 id="operator-definition"><a href="#operator-definition" class="headerlink" title="operator definition"></a>operator definition</h3><p>the operator definition can be found in Chapter 3.</p>
<h3 id="the-way-to-call-composite"><a href="#the-way-to-call-composite" class="headerlink" title="the way to call composite"></a>the way to call composite</h3><p>COStream can make hierarchical dataflow graph.Therefore,one composite can call other composites.But composite can only make non-recursive calls.The specific calling method is as follows:<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a=…</span><br><span class="line"><span class="keyword">int</span> b=…</span><br><span class="line">stream&lt;<span class="keyword">int</span> x&gt;P,Q,O1;</span><br><span class="line">stream&lt;<span class="keyword">float</span> x&gt;O2;</span><br><span class="line">(O1, O2)=COM(P,Q)(a,b);</span><br></pre></td></tr></table></figure></p>
<p>P,Q,O1 and O2 are stream variables of data stream,a and b are arguments.Therefore,composite is made of 2 input streams,2 output streams and 2 parameters.</p>
<p>COStream uses composite grammar structure to describe the dataflow graph which represents stream program.It expands the stream graph structure by calling composite to implement different types of stream applications.we can know COStream language features by this example:<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">composite <span class="title">M</span> <span class="params">(output K,L, input G,H)</span> </span>&#123;             <span class="comment">//1</span></span><br><span class="line">    stream&lt;<span class="keyword">int</span> x&gt; I,J,K,L;                        <span class="comment">//2</span></span><br><span class="line">    I=O(G)();                                     <span class="comment">//3</span></span><br><span class="line">    J=P(H)();                                     <span class="comment">//4</span></span><br><span class="line">    K=Q(I,J)();                                   <span class="comment">//5</span></span><br><span class="line">    L=R(J)();                                     <span class="comment">//6</span></span><br><span class="line">&#125;                                                 <span class="comment">//7</span></span><br><span class="line">composite Main &#123;                                  <span class="comment">//8</span></span><br><span class="line">stream&lt;<span class="keyword">int</span> x&gt;A,B,C,D,E,F;                         <span class="comment">//9</span></span><br><span class="line">…</span><br><span class="line">(C,D) = M(A,B)();                                 <span class="comment">//10</span></span><br><span class="line">(E,F) = M(A,B)()    ;                             <span class="comment">//11</span></span><br><span class="line">…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The following figure describe the stream program:we can see the process that <code>Original graph</code> is expanded to <code>Expanded graph</code>.The <code>Original graph</code> contaions 2 composites M.The first M get input Streams A and B.After calculating it make output streams C and D.The second is same as first M.Line 1 defines the input stream and output stream for M.Line 8 indicates that when M is first called in Composite Main,the input stream and output stream are instantiated:G=A,H=B,K=G,L=D.In the <code>Expanded graph</code>,M is instantiated into 2 copies because it’s called 2 times.So I and J are also instantiated into 2 parts:C.I,C.J and E.I,E.J.After compiling,the stream graph structure of the stream program will be expanded into a complete stream graph,and multiple composites in the program will be converted into one.</p>
<p><img src="/img/PART1-4.5.png" alt="4.5"></p>
<h2 id="pipeline-and-splitjion-structure"><a href="#pipeline-and-splitjion-structure" class="headerlink" title="pipeline and splitjion structure"></a><code>pipeline</code> and <code>splitjion</code> structure</h2><p>In order to facilitate the construction of the dataflow grah with composite,COStream have pipeline and parallel structured hierarchical programming structures inside the composite,that is,the pipeline and splitjion structures.Figure 4.3 shows these two basic flow structures.The pipeline structure connects the different operator sequences in a straight line;the splitjoin structure performs batch parallel processing on the input stream.In order to facilitate the use of these two structures,splitjion is mixed with other operators in the composite.Both hierarchical structures are required to be single-input stream and single-output stream.</p>
<p><img src="/img/PART1-4.6-1.jpg" alt="4.6-1"></p>
<h3 id="pipeline-structure"><a href="#pipeline-structure" class="headerlink" title="pipeline structure"></a><code>pipeline</code> structure</h3><p>The structure of the pipeline is mainly composed of head and body,BNF is expressed as follows:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pipelineHead	::= ID&apos;=&apos; &apos;pipeline&apos; opInput</span><br><span class="line">		    | &apos;pipeline&apos;</span><br><span class="line">pipelineBody	::=&apos;&#123;&apos;</span><br><span class="line">                        declaration*</span><br><span class="line">                        comstreamStmts+</span><br><span class="line">                    &apos;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>pipeline consists of two parts:the first part is the definition and declaration of the variables to be used;the second part is the operation statement in the pipeline structure.the operation statement mainly includes the general C language statement,the composite call statement and the pipeline,splitjoin structure.we use add operator to dependencies between different composite.The add statement determines the connection to the operator inside the pipeline.<br>for example:<br><code>stream&lt;int x&gt;Out=pipeline(In)
{
    add  Comp1(p1);
    add  Comp2(p2);
    add  Comp3(p3);
}</code><br>Since the pipeline is a single-input and single-output structure,we specify that the composite that can be called in the pipeline must also be a single-input and single-output stream. </p>
<p>Because it is a single-input and single-output stream here,we can use ‘add’ operation to determine the flow of data between composites.therefore,the composite call and nested addition of pipeline and splitjoin do not need to give any information about the input and output data streams.we just need to give the parameters.</p>
<h3 id="splitjoin-structure"><a href="#splitjoin-structure" class="headerlink" title="splitjoin structure"></a><code>splitjoin</code> structure</h3><p>The structure of the splitjoin is mainly composed of head and body,BNF is expressed as follows:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">splitjoinHead	::= ID &apos;=&apos; &apos;splitjoin&apos; opInput</span><br><span class="line">		    | &apos;splitjoin&apos;</span><br><span class="line">splitStmt	::= &apos;split&apos; ( &apos;duplicate&apos; &apos;(&apos; &apos;)&apos; | &apos;roundrobin&apos; &apos;(&apos; expr*&apos;)&apos; ) &apos;;&apos;</span><br><span class="line">joinStmt	::= &apos;join&apos; &apos;roundrobin&apos; &apos;(&apos; expr* &apos;)&apos; &apos;;&apos;</span><br><span class="line">splitjoinBody	::= &apos;&#123;&apos;</span><br><span class="line">                        declaration*</span><br><span class="line">                        stmt*</span><br><span class="line">                        splitStmt</span><br><span class="line">                        comstreamStmts +</span><br><span class="line">                        joinStmt</span><br><span class="line">		    &apos;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p><code>splitjoin</code> consists of the keyword <code>split</code>,<code>join</code> and some declarations and statements.</p>
<p>when a stream is used as the input stream of a splitjoin structure,the stream is first split by the split node,split node generates a batch of output streams that satisfy the corresponding conditions,then the output stream called by these composites is used as the input stream of the join node.Join node merges the input streams according to the composite call,and the stream is the output of splitjoin structure.</p>
<p>There are two main ways to split in the <code>splitjoin</code> structure:<br>1.Duplicate mode,in this way all composites will have exactly the same input stream,the split node will completely copy the input stream to produce a new batch of output stream as the input of the composite.<br>2.Roundrobin(w1,…,wn) mode,in this way,the split node sends the first w1 data to the first composite,the next w2 data is sent to the second composite,and so on.</p>
<p>There is only one roundrobin way for join nodes.Similar to the pipeline structure,the called composite int the splitjoin structure is also required to be single-input stream and a single-output stream.In COStream,split and join are represented by the keywords split and join respectively.</p>
<p><img src="/img/PART1-4.6-2.png" alt="4.6-2"></p>
<p>The example in the above figure can fully explain the hierarchical and usage characteristics of <code>splitjoin</code> and <code>pipeline</code>.In the figure,the left part represents COStream code,and the right side is the corresponding data stream diagram. In this case,you can see that adding a hierarchical structure helps increase the flexibility and scalability of dataflow programming.In addition,the stream can be parameterized in <code>splitjoin</code> and <code>pipeline</code>.In this case,the number of calls to LowPassFilter and HighPassFilter in the <code>Composite SJP</code> can be determined by parameter N,N also controlls the width of the <code>splitjoin</code>,the depth of the <code>pipeline</code> can also be controlled by parameters in<code>pipeline</code>.</p>
<h2 id="operator’s-control-statements-in-composite"><a href="#operator’s-control-statements-in-composite" class="headerlink" title="operator’s control statements in composite"></a>operator’s control statements in composite</h2><p>COStream provides two control statements for the connection between operators,the first is loop control statement and the second is if-else branch control statement.The use of these two statements in COStream is described in detail below.</p>
<h3 id="1-for-statement"><a href="#1-for-statement" class="headerlink" title="1. for statement"></a>1. <code>for</code> statement</h3><p><code>for</code> statement is extended based on the original grammar of the C language in COStream.now it can be used in the operator connection.According to the characteristics of the COStream language,the <code>for</code> loop statement controlled by the operator can only be used in pipeline and splitjoin structure.And we can only use <code>add</code> operator to determine the relationship between operators in the loop body.<code>for</code> statement have different semantics in <code>pipeline</code> and <code>splitjoin</code> structure:</p>
<ul>
<li>in the pipeline structure,the operator inside the for statement is the top-down connection,as shown in the example (a) and (b)；</li>
<li>in the splitjoin structure,the operators inside the <code>for</code> statement is the left-right parallel relationship,At this time,there is no direct edge connection between the operators,as shown in the example (c) and (d).</li>
</ul>
<p><img src="/img/PART1-4.7.jpg" alt="4.7"></p>
<h3 id="2-if-and-if-else-structure"><a href="#2-if-and-if-else-structure" class="headerlink" title="2. if and if-else structure"></a>2. <code>if</code> and <code>if-else</code> structure</h3><p>The <code>If-else</code> branch control statement give support for flow statment based on the semantics of the c language.Except for the operator defined inside the composite,<code>if-else</code> flow control branch statement can be used in any branch where convection operations are required.It has the same semantics whenever it is used.Specific usage examples are as follows:<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">…</span><br><span class="line"><span class="keyword">if</span>(x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    stream&lt;<span class="keyword">int</span> x&gt;G;</span><br><span class="line">    G=MyOperator(In)&#123;</span><br><span class="line">        …</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(x==<span class="number">0</span>)&#123;</span><br><span class="line">    G= MyCompositeCall(In)(f);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	G=splitjoin(In)</span><br><span class="line">	&#123;</span><br><span class="line">		…</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure></p>

  
  
    <div class="guide-links">
      
      
        <span>← <a href="/guide/grammar-book/3.html">Streaming Data Process</a></span>
      
      
      
        <span style="float: right;"><a href="/guide/grammar-book/5.html">Inside Composite</a> →</span>
      
    </div>
  
  <div class="footer">
	Caught a mistake or want to contribute to the documentation? 
    	
	  <a href="https://github.com/DML308/costream.org/tree/master/src/guide/grammar-book/4.md" target="_blank">
		  Edit this page on GitHub!
	  </a>
  	
  </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search -->
    <link href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/search.css">
    <script src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      //appId: 'KZDIIW94S9',
      apiKey: '996d0e9a1b8f19e5e45dcacee85c4bf7',
      indexName: 'costream',
      inputSelector: selector,
      //algoliaOptions: { facetFilters: ["version:" + version] }
      })
    })
    </script>

    <!-- fastclick -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>
